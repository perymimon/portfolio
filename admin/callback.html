<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>GitHub OAuth Callback</title>
</head>
<body>
<h1>OAuth Callback</h1>
<div id="output">Processing...</div>

<script type="module">
    fetch("https://github-oauth-token.pery-mimon.workers.dev/", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: new URLSearchParams({
            // Obtained from the URL (GitHub redirect)
            code: new URLSearchParams(window.location.search).get('code'),
            // Retrieved from localStorage (set during PKCE generation)
            code_verifier: localStorage.getItem('pkce_verifier')
        })
    })
        .then(response => response.json())
        .then(data => {
            if (data.access_token) {
                // Save the access token for your session
                sessionStorage.setItem("github_access_token", data.access_token);
                // Optionally, redirect to the CMS or dashboard
                window.opener.location.reload();
                // window.close()
            } else {
                console.error("Error exchanging token:", data)
            }
        })
        .catch(err => console.error("Request failed:", err))
</script>
</body>
</html>
